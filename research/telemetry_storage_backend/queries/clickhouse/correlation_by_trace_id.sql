SELECT s.trace_id, s.service, uniq(s.span_id) AS span_count, uniq(l.ts) AS log_count, uniq(m.ts) AS metric_count FROM telemetry.spans s LEFT JOIN telemetry.logs l ON l.trace_id=s.trace_id AND l.trace_id!='' LEFT JOIN telemetry.metrics m ON JSONExtractString(m.labels,'trace_id')=s.trace_id WHERE s.ts_start>=now()-INTERVAL 7 DAY GROUP BY s.trace_id,s.service ORDER BY (span_count+log_count+metric_count) DESC LIMIT 20
